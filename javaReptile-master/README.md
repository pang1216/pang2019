java简单实现爬虫、jsoup实现网页抓取、POI实现数据导出Excel
原创?2018年03月22日 22:10:53
?标签：
?爬虫?/
?jsout?/
?java?/
?poi?/
?maven
?3
概要：
? ? ?使用java实现爬虫，并且把数据保存到excel表中格式化保存；目标网站如下，爬取该网站的农产品价格！！！！

一、知识准备
jsoup：
jsoup?是一款?Java?的?HTML?解析器，可直接解析某个?URL?地址、HTML?文本内容。它提供了一套非常省力的API，可通过?DOM，CSS?以及类似于?jQuery?的操作方法来取出和操作数据。
jsoup官网:http://jsoup.org
目前最新版本：jsoup-1.10.2.jar
?jsoup?的主要功能如下：
?1.?从一个?URL，文件或字符串中解析?HTML；
2.?使用?DOM?或?CSS?选择器来查找、取出数据；
3.?可操作?HTML?元素、属性、文本；
POI：
POI全称?Poor Obfuscation Implementation,利用POI接口可以通过JAVA操作Microsoft office?套件工具的读写功能。官网：http://poi.apache.org?，POI支持office的所有版本。
二、maven工程的依赖jar准备
[html]?view plain?copy
1.<project?xmlns="http://maven.apache.org/POM/4.0.0"?xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"??
2.<span?style="white-space:pre;">?</span>xsi:schemaLocation="http://maven.apache.org/POM/4.0.0?http://maven.apache.org/xsd/maven-4.0.0.xsd">??
3.<span?style="white-space:pre;">?</span><modelVersion>4.0.0</modelVersion>??
4.<span?style="white-space:pre;">?</span><groupId>com.dark</groupId>??
5.<span?style="white-space:pre;">?</span><artifactId>reptile</artifactId>??
6.<span?style="white-space:pre;">?</span><version>0.0.1-SNAPSHOT</version>??
7.<span?style="white-space:pre;">?</span><dependencies>??
8.<span?style="white-space:pre;">?</span>??
9.<span?style="white-space:pre;">?</span>??<!--???jsoup和httpclient?-->??
10.<span?style="white-space:pre;">?????</span><dependency>??
11.<span?style="white-space:pre;">?????????</span><groupId>org.apache.httpcomponents</groupId>??
12.<span?style="white-space:pre;">?????????</span><artifactId>httpclient</artifactId>??
13.<span?style="white-space:pre;">?????????</span><version>4.5.3</version>??
14.<span?style="white-space:pre;">?????</span></dependency>??
15.<span?style="white-space:pre;">?????</span><dependency>??
16.<span?style="white-space:pre;">?????????</span><groupId>org.apache.httpcomponents</groupId>??
17.<span?style="white-space:pre;">?????????</span><artifactId>httpmime</artifactId>??
18.<span?style="white-space:pre;">?????????</span><version>4.5.3</version>??
19.<span?style="white-space:pre;">?????</span></dependency>??
20.??
21.??
22.<span?style="white-space:pre;">?????</span><dependency>??
23.<span?style="white-space:pre;">?????????</span><groupId>org.jsoup</groupId>??
24.<span?style="white-space:pre;">?????????</span><artifactId>jsoup</artifactId>??
25.<span?style="white-space:pre;">?????????</span><version>1.10.2</version>??
26.<span?style="white-space:pre;">?????</span></dependency>??
27.??
28.??
29.?????
30.???????<!--???poi的依赖包?-->??
31.<span?style="white-space:pre;">?????</span><dependency>??
32.<span?style="white-space:pre;">?????????</span><groupId>org.apache.poi</groupId>??
33.<span?style="white-space:pre;">?????????</span><artifactId>poi</artifactId>??
34.<span?style="white-space:pre;">?????????</span><version>3.16</version>??
35.<span?style="white-space:pre;">?????</span></dependency>??
36.<span?style="white-space:pre;">?????</span><dependency>??
37.<span?style="white-space:pre;">?????????</span><groupId>org.apache.poi</groupId>??
38.<span?style="white-space:pre;">?????????</span><artifactId>poi-ooxml-schemas</artifactId>??
39.<span?style="white-space:pre;">?????????</span><version>3.16</version>??
40.<span?style="white-space:pre;">?????</span></dependency>??
41.<span?style="white-space:pre;">?????</span><dependency>??
42.<span?style="white-space:pre;">?????????</span><groupId>org.apache.poi</groupId>??
43.<span?style="white-space:pre;">?????????</span><artifactId>poi-excelant</artifactId>??
44.<span?style="white-space:pre;">?????????</span><version>3.16</version>??
45.<span?style="white-space:pre;">?????</span></dependency>??
46.<span?style="white-space:pre;">?????</span><dependency>??
47.<span?style="white-space:pre;">?????????</span><groupId>org.apache.poi</groupId>??
48.<span?style="white-space:pre;">?????????</span><artifactId>poi-examples</artifactId>??
49.<span?style="white-space:pre;">?????????</span><version>3.16</version>??
50.<span?style="white-space:pre;">?????</span></dependency>??
51.<span?style="white-space:pre;">?</span></dependencies>??
52.??
53.</project>??
三、代码实现
3.1、创建product对象实现，数据的接收和过渡；
[java]?view plain?copy
1.package?com.dark.pojo;??
2./**??作者：darkjazz??
3.*????日期：2018年3月22日?下午7:32:03?
4.*/??
5.public?class?Product?{??
6.?????private?String?productName;??
7.?????private?String?lowerPrice;??
8.?????private?String?averagePrice;??
9.?????private?String?maxPrice;??
10.?????//规格??
11.?????private?String?specs;??
12.?????//单位??
13.?????private?String?unit;??
14.?????//发布日期??
15.?????private?String?date;??
16.??
17.????@Override??
18.????public?String?toString()?{??
19.????????return?"Product?[productName="?+?productName?+?",?lowerPrice="?+?lowerPrice?+?",?averagePrice="?+?averagePrice??
20.????????????????+?",?maxPrice="?+?maxPrice?+?",?specs="?+?specs?+?",?unit="?+?unit?+?",?date="?+?date?+?"]";??
21.????}??
22.??
23.????public?String?getProductName()?{??
24.????????return?productName;??
25.????}??
26.??
27.????public?void?setProductName(String?productName)?{??
28.????????this.productName?=?productName;??
29.????}??
30.??
31.????public?String?getLowerPrice()?{??
32.????????return?lowerPrice;??
33.????}??
34.??
35.????public?void?setLowerPrice(String?lowerPrice)?{??
36.????????this.lowerPrice?=?lowerPrice;??
37.????}??
38.??
39.????public?String?getAveragePrice()?{??
40.????????return?averagePrice;??
41.????}??
42.??
43.????public?void?setAveragePrice(String?averagePrice)?{??
44.????????this.averagePrice?=?averagePrice;??
45.????}??
46.??
47.????public?String?getMaxPrice()?{??
48.????????return?maxPrice;??
49.????}??
50.??
51.????public?void?setMaxPrice(String?maxPrice)?{??
52.????????this.maxPrice?=?maxPrice;??
53.????}??
54.??
55.????public?String?getSpecs()?{??
56.????????return?specs;??
57.????}??
58.??
59.????public?void?setSpecs(String?specs)?{??
60.????????this.specs?=?specs;??
61.????}??
62.??
63.????public?String?getUnit()?{??
64.????????return?unit;??
65.????}??
66.??
67.????public?void?setUnit(String?unit)?{??
68.????????this.unit?=?unit;??
69.????}??
70.??
71.????public?String?getDate()?{??
72.????????return?date;??
73.????}??
74.??
75.????public?void?setDate(String?date)?{??
76.????????this.date?=?date;??
77.????}??
78.??????
79.}??
3.2、使用poi的excel操作的方法，把下一步爬取到的数据保存到本地硬盘的excel表中
[java]?view plain?copy
1.package?com.dark.util;??
2.??
3.import?java.io.File;??
4.import?java.io.FileNotFoundException;??
5.import?java.io.FileOutputStream;??
6.import?java.io.IOException;??
7.import?java.util.List;??
8.??
9.import?org.apache.poi.ss.usermodel.Cell;??
10.import?org.apache.poi.ss.usermodel.CellStyle;??
11.import?org.apache.poi.ss.usermodel.HorizontalAlignment;??
12.import?org.apache.poi.ss.usermodel.Row;??
13.import?org.apache.poi.ss.usermodel.VerticalAlignment;??
14.import?org.apache.poi.ss.util.CellRangeAddress;??
15.import?org.apache.poi.xssf.usermodel.XSSFCell;??
16.import?org.apache.poi.xssf.usermodel.XSSFRow;??
17.import?org.apache.poi.xssf.usermodel.XSSFSheet;??
18.import?org.apache.poi.xssf.usermodel.XSSFWorkbook;??
19.??
20.import?com.dark.pojo.Product;??
21.??
22./**??作者：darkjazz?
23.*????日期：2018年3月22日?下午8:00:33?
24.*/??
25.public?class?POItoExcel?{??
26.?????public?static?void?main(String[]?args)?{??
27.??????????
28.????}??
29.????public?static?void?toExcel(List<Product>?list)?throws?FileNotFoundException,?IOException{??
30.???????????
31.????????//新建文档?????
32.????????XSSFWorkbook?workBook=new?XSSFWorkbook();??
33.??????????
34.????????//创建表??
35.????????XSSFSheet?sheet=workBook.createSheet();??
36.??????????
37.???????????//合并标的标题??
38.????????????CellRangeAddress?cra=new?CellRangeAddress(0,1,?0,?6);??
39.????????????sheet.addMergedRegion(cra);??
40.????????????//显示的文本为左上角的内容??
41.????????????Row?row2=sheet.createRow(0);??
42.????????????Cell?cell=row2.createCell(0);??
43.????????????cell.setCellValue("商品价格表");??
44.????????????//设置单元格的格式??
45.????????????CellStyle?cs=workBook.createCellStyle();??
46.????????????cs.setAlignment(HorizontalAlignment.CENTER);??
47.????????????cs.setVerticalAlignment(VerticalAlignment.CENTER);??
48.????????????cs.setFillBackgroundColor((short)?59);??
49.????????????????cell.setCellStyle(cs);??
50.????????????//表头??
51.????????????Row?row=sheet.createRow(2);??
52.??????????????
53.????????????Cell?cell11=row.createCell(0);??
54.????????????cell11.setCellValue("品名");??
55.????????????Cell?cell22=row.createCell(1);??
56.????????????cell22.setCellValue("最低价");??
57.????????????Cell?cell33=row.createCell(2);??
58.????????????cell33.setCellValue("平均价");??
59.????????????Cell?cell44=row.createCell(3);??
60.????????????cell44.setCellValue("最高价");??
61.????????????Cell?cell55=row.createCell(4);??
62.????????????cell55.setCellValue("规格");??
63.????????????Cell?cell66=row.createCell(5);??
64.????????????cell66.setCellValue("单位");??
65.????????????Cell?cell77=row.createCell(6);??
66.????????????cell77.setCellValue("发布日期");??
67.????????????//表中的数据??
68.??
69.????????for(int?i=0;i<list.size();i++){??
70.????????//创建行??
71.????????XSSFRow?row4=sheet.createRow(i+3);??
72.????
73.????????//创建单元格??
74.????????XSSFCell?cell1=row4.createCell(0);??
75.????????XSSFCell?cell2=row4.createCell(1);??
76.????????XSSFCell?cell3=row4.createCell(2);??
77.????????XSSFCell?cell4=row4.createCell(3);??
78.????????XSSFCell?cell5=row4.createCell(4);??
79.????????XSSFCell?cell6=row4.createCell(5);??
80.????????XSSFCell?cell7=row4.createCell(6);??
81.????????????//在单元格中写入数据??
82.????????cell1.setCellValue(list.get(i).getProductName());??
83.????????cell2.setCellValue(list.get(i).getLowerPrice());??
84.????????cell3.setCellValue(list.get(i).getAveragePrice());??
85.????????cell4.setCellValue(list.get(i).getMaxPrice());??
86.????????cell5.setCellValue(list.get(i).getSpecs());??
87.????????cell6.setCellValue(list.get(i).getUnit());??
88.????????cell7.setCellValue(list.get(i).getDate());??
89.????????}??
90.?????????//把这个文档写入文件??
91.????????workBook.write(new?FileOutputStream(new?File("你的目标目录"+\\product.xlsx"))?);??
92.????????System.out.println("写入excel完毕");??
93.????????//关闭流??
94.????????workBook.close();??
95.??????????
96.????}??
97.???????
98.???????
99.}??
3.3、主方法，使用jsout实现爬虫，并调用3.2中的方法实现写入文件
[java]?view plain?copy
1.package?com.dark.reptile;??
2.??
3.import?java.io.FileNotFoundException;??
4.import?java.io.IOException;??
5.import?java.util.ArrayList;??
6.import?java.util.List;??
7.??
8.import?org.jsoup.Jsoup;??
9.import?org.jsoup.nodes.Document;??
10.import?org.jsoup.nodes.Element;??
11.import?org.jsoup.select.Elements;??
12.??
13.import?com.dark.pojo.Product;??
14.import?com.dark.util.POItoExcel;??
15.??
16./**??作者：darkjazz??
17.*????日期：2018年3月22日?下午7:11:20?
18.*/??
19.public?class?Reptile?{??
20.???????public?static?void?main(String[]?args)?throws?FileNotFoundException,?IOException?{??
21.???????????List<Product>?list=getInfor("http://www.xinfadi.com.cn/marketanalysis/1/list/1.shtml",?1000);??
22.???????????POItoExcel.toExcel(list);??
23.????}??
24.??????
25.???????//可以指定网址，并且按照需求爬取前多少页的数据??
26.???????public?static?List<Product>?getInfor(String?url,int?maxPage){??
27.???????????List<Product>?proList=new?ArrayList<Product>();??
28.???????????for(int?i=2;i<=maxPage+1;i++){??
29.????????????????
30.?????????????try?{??
31.??????????????????
32.????????????????Document?doc=Jsoup.connect(url).get();??
33.????????????????Elements?table=doc.select(".hq_table");??
34.????????????????Elements?tbody=table.select("tbody");??
35.????????????????Elements?trList=tbody.select("tr");??
36.????????????????trList.remove(0);??
37.????????????????for(Element?tr:trList){??
38.????????????????????Elements?tdList=tr.select("td");??
39.????????????????????Product?product=new?Product();??
40.????????????????????product.setProductName(tdList.get(0).html().toString());??
41.????????????????????product.setLowerPrice(tdList.get(1).html().toString());??
42.????????????????????product.setAveragePrice(tdList.get(2).html().toString());??
43.????????????????????product.setMaxPrice(tdList.get(3).html().toString());??
44.????????????????????product.setSpecs(tdList.get(4).html().toString());??
45.????????????????????product.setUnit(tdList.get(5).html().toString());??
46.????????????????????product.setDate(tdList.get(6).html().toString());??
47.????????????????????/*System.out.println(product.toString());*/??
48.????????????????????proList.add(product);??
49.????????????????}??
50.??????????????????
51.????????????}?catch?(IOException?e)?{??
52.????????????????//?TODO?Auto-generated?catch?block??
53.????????????????e.printStackTrace();??
54.????????????}??
55.??????
56.???????????url="http://www.xinfadi.com.cn/marketanalysis/1/list/"+i+".shtml";??
57.???????????}??
58.???????????System.out.println("爬取前"+maxPage+"成功");??
59.????????return?proList;??
60.?????????????
61.???????}??
62.??????
63.??????
64.??????
65.}??
四、效果展示

本次爬取实现爬取1000页数据的效果！！！！

五、源码包
欢迎访问我的github首页获取
博主的github地址，获取当前项目源码

完结、散花！！！！！
